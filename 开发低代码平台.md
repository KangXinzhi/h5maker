# 仿[有赞](https://account.youzan.com/)店铺的低代码平台开发

## 一. 项目设计
### 1.1布局
- 店铺列表页布局：
![''](./public/lowcode.png)
- 店铺列表页布局：
![''](./public/lowcode.png)
---
### 1.2功能
- 从组件区拖拽组件，拖拽到预览区域，
- 选中预览区域的组件可以在配置区进行样式配置
- 预览区域的组件可以进行拖拽排序
- 点击头部预览按钮可以进行预览
- 保存按钮保存数据
---
### 1.3项目设计
- 参考有赞预览区设计，发现其内部使用的是iframe，预览区设计成单独的iframe的方式显示，这样的好处：方便预览,节省代码，不然要实现两边展示区的逻辑
- 项目分为两个系统，预览区iframe系统和编辑器系统
- 数据库采用浏览器的indexDB，配套的三方库采用[Dexie](https://dexie.org/)
- 项目难点：跨 iframe 拖拽，一些拖拽组件如react-dnd react-beautiful-dnd 都无法实现，参考了掘金上的一些文章，转转团队它们因react-dnd不支持跨iframe便放弃了，自己使用原生H5的拖拽事件封装一个。我的设计思路：数据驱动视图，可以在拖动时显示一个和iframe样式相同的盒子，来模拟iframe进行拖拽，因为在同一组件中并未设计到跨iframe并不会有任何问题，可以使用任何方式完成如react-dnd，只需拖拽结束后同步数据，传给iframe，iframe接收到数据后进行显示
- 跨 Iframe 通信，采用 postMessage 通信
----
### 1.4组件区schema定义
```
// 类型定义
{
  text: string  // 组件区中组件的名称
  name: string  // 组件区中组件的的key
  icon: string  // 组件区中组件的icon地址
  config: {
    label: string   // 配置区中title名称
    type: string  // 配置区组件类型
    format: string  
    value?: string
    config?: {  // 默认配置项
      icon: string
      style: React.CSSProperties
      tooltip: string,
    }
    configOptions?: {  // 配置区中组件配置列表
      icon: string
      style: React.CSSProperties
      tooltip: string,
    }[]
  }[]
}

// 实际应用(标题)
{
    text: '标题文本',
    name: "titleText",
    icon: 'https://img01.yzcdn.cn/upload_files/2022/06/17/FjAs6eTmbK_4lQRI3GYXu97Fj_B_.png',
    config: [
      {
        label: "标题内容",
        type: "input",
        format: "title",
        value: '请输入文本内容'
      },
      {
        label: "描述内容",
        type: "textarea",
        format: "content",
        value: '请输入标题内容'
      },
      {
        label: "显示位置",
        type: "legend-style-line",
        format: "position",
        config: {
          icon: '#icon-alignleft',
          style: {
            justifyContent: 'left',
          },
          tooltip: '居左显示',
        },
        configOptions: [
          {
            icon: '#icon-alignleft',
            style: {
              justifyContent: 'left',
            },
            tooltip: '居左显示',
          },
          {
            icon: '#icon-aligncenter',
            style: {
              justifyContent: 'center',
            },
            tooltip: '居中显示',
          }
        ]
      },
      {
        label: "标题大小",
        type: "legend-style-line",
        format: "title-size",
        config: {
          ...
        },
        configOptions: [
          ...
        ]
      },
      {
        label: "描述大小",
        type: "legend-style-line",
        format: "content-size",
        config: {
          ...
        },
        configOptions: [
          ...
        ]
      },
    ],
  }
```
----
### 1.5数据库设计

数据库：myDatabase
表：ShopList
属性：
|  id   | title  | state  | createTime  | memo  | schema  |
|  ----  | ----  | ----  | ----  | ----  | ----  |
| 自增  | 标题 | 状态 | 创建时间 | 备注 | schema |


对应的 indexDB数据库
```
import Dexie from 'dexie';

export const db: any = new Dexie('myDatabase');
db.version(1).stores({
  ShopList: '++id, title, state, createTime, memo, schema',
});
```
----

## 项目正式
